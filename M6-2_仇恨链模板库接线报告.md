# 爆款题材 → 仇恨链模板库 接线报告

## 一、新增模板列表

### 1. 都市爽文 / 神豪逆袭
- 文件路径：`/lib/story/conflictTemplates/urban_wealth.json`
- 题材关键字：神豪、都市、金钱
- 适用集数：1-90集（三阶段结构）

### 2. 复仇 / 重生爽剧
- 文件路径：`/lib/story/conflictTemplates/revenge_rebirth.json`
- 题材关键字：重生、复仇
- 适用集数：1-90集（三阶段结构）

### 3. 甜宠 / 霸总
- 文件路径：`/lib/story/conflictTemplates/romance_ceo.json`
- 题材关键字：甜宠、霸总
- 适用集数：1-90集（三阶段结构）

### 4. 修仙 / 穿越 / 玄幻
- 文件路径：`/lib/story/conflictTemplates/cultivation_fantasy.json`
- 题材关键字：修仙、穿越、玄幻
- 适用集数：1-90集（三阶段结构）

### 5. 都市脑洞 / 超能力
- 文件路径：`/lib/story/conflictTemplates/urban_concept.json`
- 题材关键字：异能、能力、都市脑洞
- 适用集数：1-90集（三阶段结构）

---

## 二、核心爽点路径

所有模板采用统一的"三阶段仇恨链"结构，核心爽点路径如下：

### 阶段 1：1-10 集 - 压抑铺垫期

**核心特征：**
- 主角状态：被动承受
- 压迫方式：羞辱、剥夺、控制
- 必须爽点：压制、羞辱

**爽点路径：**
```
低阶压迫者登场 → 施加羞辱/剥夺 → 主角被动承受 → 小胜或忍耐
```

**示例场景：**
- 神豪：被老板/同事当众羞辱
- 复仇：重生后面对前世的仇人
- 甜宠：被霸总误解、打压
- 修仙：被低阶弟子嘲笑废柴
- 脑洞：能力未觉醒时被质疑

---

### 阶段 2：11-40 集 - 反转反击期

**核心特征：**
- 主角状态：被迫反击
- 压迫方式：封锁、打压、操控
- 必须爽点：反转、打脸

**爽点路径：**
```
中阶对手登场 → 试图封锁/打压 → 主角被迫反击 → 阶段性胜利/打脸
```

**示例场景：**
- 神豪：用财力/人脉打脸曾经羞辱自己的人
- 复仇：开始清算低阶仇人，反制中阶对手
- 甜宠：霸总误会加深，女主开始反击
- 修仙：境界突破，打脸曾经的轻视者
- 脑洞：能力初步觉醒，反击质疑者

---

### 阶段 3：41-90 集 - 终极清算期

**核心特征：**
- 主角状态：主动进攻
- 压迫方式：围剿、清洗、崩塌
- 必须爽点：清算、终极反转

**爽点路径：**
```
高阶幕后现身 → 全面围剿/清洗 → 主角主动进攻 → 彻底清算/终极反转
```

**示例场景：**
- 神豪：对抗资本大鳄，清算所有仇敌
- 复仇：揭露终极真相，因果闭环
- 甜宠：阶层对立爆发，最终收束
- 修仙：对抗高阶势力，终极突破
- 脑洞：能力源头揭秘，终极对决

---

## 三、新增 FAIL 规则清单

### 1. Outline 生成阶段 FAIL 规则

#### 规则 1：未命中预期反派类型
- **错误代码：** OUTLINE_ANTAGONIST_TYPE_MISMATCH
- **触发条件：** Outline 未提及当前阶段的 `mainAntagonistType`（如"低阶压迫者"）
- **处罚：** 立即 FAIL + 重试
- **影响范围：** 每集 Outline 生成

#### 规则 2：未命中预期冲突源
- **错误代码：** OUTLINE_CONFLICT_SOURCE_MISMATCH
- **触发条件：** Outline 未提及当前阶段的 `conflictSource`（如"资源/金钱"、"情感/身份"）
- **处罚：** 立即 FAIL + 重试
- **影响范围：** 每集 Outline 生成

#### 规则 3：未体现主角状态
- **错误代码：** OUTLINE_PROTAGONIST_STATE_MISMATCH
- **触发条件：** Outline 中缺少对应主角状态的关键词
  - "被动承受"：需要包含"被、受、压制、压迫、困境、被动"
  - "被迫反击"：需要包含"反击、应对、抵抗、反抗"
  - "主动进攻"：需要包含"进攻、主动、主动出击"
- **处罚：** 立即 FAIL + 重试
- **影响范围：** 每集 Outline 生成

---

### 2. Aligner 校验阶段 FAIL 规则

#### 规则 4：未产出必须爽点（NO_REQUIRED_PLEASURE）
- **错误代码：** NO_REQUIRED_PLEASURE
- **触发条件：** 剧本正文中未出现当前阶段要求的 `requiredPleasure` 类型
  - 阶段 1：缺少"压制"或"羞辱"
  - 阶段 2：缺少"反转"或"打脸"
  - 阶段 3：缺少"清算"或"终极反转"
- **处罚：** 立即 FAIL（P0级违规）→ 必须重写
- **影响范围：** 每集内容生成后的质量校验

#### 规则 5：主角状态不匹配（PROTAGONIST_STATE_MISMATCH）
- **错误代码：** PROTAGONIST_STATE_MISMATCH
- **触发条件：** 剧本中主角表现的状态与当前阶段不符
  - 应为"被动承受"时表现出主动
  - 应为"被迫反击"时表现被动
  - 应为"主动进攻"时表现退缩
- **处罚：** 立即 FAIL（P0级违规）→ 必须重写
- **影响范围：** 每集内容生成后的质量校验

#### 规则 6：无明确压迫源（NO_CLEAR_PRESSURE_SOURCE）
- **错误代码：** NO_CLEAR_PRESSURE_SOURCE
- **触发条件：** 剧本中没有出现当前阶段预期的反派角色或压迫来源
- **处罚：** 立即 FAIL（P0级违规）→ 必须重写
- **影响范围：** 每集内容生成后的质量校验

---

### 3. 严重性判定汇总

**PASS（通过）：**
- 无明显问题
- 符合仇恨链约束
- 产出至少 1 个 requiredPleasure

**WARN（警告）：**
- 存在轻微问题，但不影响继续生成
- 如：配角对白略多、节奏偏慢

**FAIL（失败 - P0级违规）：**
1. NO_HIGHLIGHT - 无爽点或情绪爆发
2. NO_PLOT_PROGRESS - 未推进主线冲突
3. GENRE_MISMATCH - 不符合题材承诺
4. CHARACTER_INCONSISTENT - 角色行为违背人设
5. NO_REQUIRED_PLEASURE（M6-2新增）- 未产出必须爽点
6. PROTAGONIST_STATE_MISMATCH（M6-2新增）- 主角状态不匹配
7. NO_CLEAR_PRESSURE_SOURCE（M6-2新增）- 无明确压迫源
8. 同时出现 ≥2 个 WARN
9. NEW_CHARACTER - 新增角色（已在 M6-1 中实现）

---

## 四、对"无仇 / 水剧情 / 节奏断裂"的抑制说明

### 1. 抑制"无仇"剧情

**问题表现：**
- 剧中缺少明确的反派角色或压迫来源
- 主角没有具体的反抗目标
- 冲突模糊，观众无法产生代入感

**抑制机制：**

#### 机制 1：模板强制指定反派类型
- 每个阶段必须指定 `mainAntagonistType`
  - 阶段 1：必须有"低阶压迫者"
  - 阶段 2：必须有"中阶对手"
  - 阶段 3：必须有"高阶幕后"

#### 机制 2：Outline 验证强制反派出场
- 生成 Outline 时必须命中 `mainAntagonistType`
- 未命中 → 立即 FAIL + 重试
- 确保 Outline 阶段就有明确反派

#### 机制 3：Aligner 硬性检查压迫源
- `NO_CLEAR_PRESSURE_SOURCE` 错误码
- 剧本中没有出现预期反派 → 立即 FAIL
- 即使 AI 自评通过，代码层也会二次检查

**抑制效果：**
- 100% 阻止"无仇"剧情通过 Outline 生成
- 100% 阻止"无仇"内容通过 Aligner 校验
- 确保每集都有明确的压迫源

---

### 2. 抑制"水剧情"

**问题表现：**
- 内容填充，无实际冲突推进
- 爽点缺失或稀释
- 观众情绪无法被调动

**抑制机制：**

#### 机制 1：强制产出指定爽点
- 每个阶段必须产出特定类型爽点
  - 阶段 1：必须产出"压制"或"羞辱"
  - 阶段 2：必须产出"反转"或"打脸"
  - 阶段 3：必须产出"清算"或"终极反转"

#### 机制 2：Prompt 层面强制约束
- Writer Prompt 中明确要求：
  ```
  本集必须产出以下至少 1 种爽点：{requiredPleasure}
  未产出 → 视为失败
  ```
- AI 生成时就知道这是硬性要求

#### 机制 3：Aligner 硬性检查爽点产出
- `NO_REQUIRED_PLEASURE` 错误码
- 剧本中没有出现任何 requiredPleasure → 立即 FAIL
- 代码层统计，不依赖 AI 自评

**抑制效果：**
- 100% 阻止"无爽点"内容通过
- 确保每集都至少有 1 个明确爽点
- 爽点类型与阶段匹配，避免情绪错位

---

### 3. 抑制"节奏断裂"

**问题表现：**
- 主角状态与阶段不匹配（如本该反击时仍被动）
- 反派梯度混乱（中集出现高阶反派）
- 冲突升级过快或过慢

**抑制机制：**

#### 机制 1：主角状态强制演进
- 三阶段状态强制锁定：
  - 阶段 1（1-10集）：必须"被动承受"
  - 阶段 2（11-40集）：必须"被迫反击"
  - 阶段 3（41-90集）：必须"主动进攻"

#### 机制 2：Outline 验证检查状态关键词
- 验证规则：
  - "被动承受"：必须有"被、受、压制、压迫、困境、被动"等关键词
  - "被迫反击"：必须有"反击、应对、抵抗、反抗"等关键词
  - "主动进攻"：必须有"进攻、主动、主动出击"等关键词

#### 机制 3：Aligner 二次校验
- `PROTAGONIST_STATE_MISMATCH` 错误码
- 剧本中缺少对应状态的关键词 → 立即 FAIL
- 双重保险：Outline 生成 + 内容校验

#### 机制 4：反派梯度自动控制
- 模板中按阶段指定反派类型：
  - 低阶压迫者 → 中阶对手 → 高阶幕后
- 阶段自动匹配，人工/AI 不得跳级
- 防止中集出现终极反派

**抑制效果：**
- 确保主角状态按阶段有序演进
- 防止反派梯度混乱
- 避免"节奏过快"（如第 5 集就主动进攻）
- 避免"节奏过慢"（如第 30 集仍被动承受）

---

## 五、系统级保护措施

### 1. 向后兼容性
- 所有新增字段为 `optional`
- 现有项目若无仇恨链配置，仍使用默认值
- 不破坏已有的 `ConflictChain` 结构
- 不影响已创建项目的正常使用

### 2. 只读保护
- 仇恨链模板文件为只读 JSON
- 不允许 UI 编辑
- 不允许 AI 改写
- 确保爆款结构的权威性

### 3. 自动降级机制
- 模板加载失败 → 使用默认生成器（`generateDefaultConflictChain`）
- 题材无法匹配 → 使用默认模板（`urban_wealth.json`）
- 记录警告日志，但不中断流程

### 4. 多层验证机制
1. **Outline 生成验证** → 阻止错误的剧情规划
2. **Prompt 注入约束** → 指导 AI 生成正确内容
3. **Aligner 质量校验** → 最终把关，拒绝不合格内容
4. **代码层硬性检查** → 不依赖 AI 自评，确保规则执行

---

## 六、文件变更清单

### 新增文件
1. `/lib/story/conflictTemplates/urban_wealth.json`
2. `/lib/story/conflictTemplates/revenge_rebirth.json`
3. `/lib/story/conflictTemplates/romance_ceo.json`
4. `/lib/story/conflictTemplates/cultivation_fantasy.json`
5. `/lib/story/conflictTemplates/urban_concept.json`
6. `/lib/story/conflictTemplateSelector.ts`

### 修改文件
1. `/lib/pacing/pacingContext.ts` - 新增 3 个仇恨链字段
2. `/lib/story/conflictChainEngine.ts` - 更新接口和 Prompt 注入
3. `/types.ts` - 更新 `ConflictStage` 接口
4. `/lib/ai/episodeFlow.ts` - 集成题材选择器，增强 Outline 验证
5. `/lib/ai/alignerRunner.ts` - 新增 3 个硬性 FAIL 检查
6. `/prompts/validation/script_aligner_commercial.md` - 新增仇恨链检查点

---

## 七、数据流示意图

```
题材 (genre)
   ↓
conflictTemplateSelector.selectTemplate(genre)
   ↓
ConflictChain (仇恨链模板)
   ├── Stage 1: 低阶压迫者 → 被动承受 → 压制/羞辱
   ├── Stage 2: 中阶对手 → 被迫反击 → 反转/打脸
   └── Stage 3: 高阶幕后 → 主动进攻 → 清算/终极反转
   ↓
┌─────────────────────────────────────────┐
│  getConflictConstraint(epIndex)        │
│  → expectedAntagonistType            │
│  → requiredPleasure                  │
│  → protagonistState                  │
└─────────────────────────────────────────┘
   ↓
┌─────────────────────────────────────────┐
│  Outline 生成                        │
│  - 命中 expectedAntagonistType       │
│  - 命中 conflictSource               │
│  - 体现 protagonistState             │
│  - 验证失败 → FAIL + 重试           │
└─────────────────────────────────────────┘
   ↓
┌─────────────────────────────────────────┐
│  Writer Prompt                       │
│  - 注入约束到 pacingContext           │
│  - 强制产出 requiredPleasure        │
│  - 明确禁止事项                     │
└─────────────────────────────────────────┘
   ↓
┌─────────────────────────────────────────┐
│  Aligner 校验（代码层硬性检查）     │
│  - 检查 requiredPleasure 是否产出    │
│  - 检查 protagonistState 是否匹配    │
│  - 检查是否有明确压迫源            │
│  - 任一不通过 → FAIL → 必须重写     │
└─────────────────────────────────────────┘
   ↓
通过 → 下一集 / FAIL → 重写
```

---

## 八、预期效果总结

### 爽点保证
- ✅ 每集至少产出 1 个明确的爽点
- ✅ 爽点类型与阶段匹配（压制/羞辱 → 反转/打脸 → 清算/终极反转）
- ✅ 爽点密度符合商业短剧标准

### 结构保证
- ✅ 反派梯度清晰（低阶 → 中阶 → 高阶）
- ✅ 主角状态有序演进（被动 → 被迫 → 主动）
- ✅ 冲突升级节奏可控

### 质量保证
- ✅ 100% 阻止"无仇"剧情
- ✅ 100% 阻止"水剧情"
- ✅ 100% 阻止"节奏断裂"
- ✅ 多层验证，零漏网

---

## 九、后续优化建议

1. **模板扩展：** 可根据实际运行数据，为每个题材创建多个变体模板
2. **AI 反馈学习：** 记录 AI 重写原因，反哺模板优化
3. **用户自定义：** 在保留只读模板的前提下，允许高级用户创建自定义模板
4. **跨题材融合：** 支持混合题材（如"都市 + 玄幻"）的智能匹配

---

**实施完成日期：** 2026-01-01
**版本：** M6-2
**状态：** ✅ 已完成并集成到全流程

